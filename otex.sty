\NeedsTeXFormat{LaTeX2e}
\RequirePackage{expl3}
\ProvidesExplPackage {otex} {2025-01-16} {1.2} {Orion's Custom Package - Minimalist Refactor}

\RequirePackage { l3keys2e }

% Booleans
\bool_new:N \g_otex_load_layout_bool
\bool_new:N \g_otex_load_fonts_bool
\bool_new:N \g_otex_load_ctex_bool
\bool_new:N \g_otex_load_theorems_bool
\bool_new:N \g_otex_load_hyperref_bool
\bool_new:N \g_otex_load_cleveref_bool
\bool_new:N \g_otex_load_caption_bool
\bool_new:N \g_otex_load_algo_bool
\bool_new:N \g_otex_load_math_bool
\bool_new:N \g_otex_load_graphics_bool
\bool_new:N \g_otex_load_listings_bool
\bool_new:N \g_otex_load_minted_bool
\bool_new:N \g_otex_load_tables_bool
\bool_new:N \g_otex_load_floats_bool
\bool_new:N \g_otex_load_bib_bool
\bool_new:N \g_otex_load_toc_bool
\bool_new:N \g_otex_load_index_bool
\bool_new:N \g_otex_load_appendix_bool
\bool_new:N \g_otex_float_section_bool
\bool_new:N \g_otex_english_bool

% Text Variables
\tl_new:N \g_otex_bib_backend_tl
\tl_new:N \g_otex_bib_style_tl
\tl_new:N \g_otex_algo_backend_tl
\tl_new:N \g_otex_font_set_tl
\tl_new:N \g_otex_font_main_tl
\tl_new:N \g_otex_font_sans_tl
\tl_new:N \g_otex_font_mono_tl
\tl_new:N \g_otex_font_cjk_main_tl
\tl_new:N \g_otex_pdf_title_tl
\tl_new:N \g_otex_pdf_author_tl

% Key Definitions
\keys_define:nn { otex }
  {
    layout      .bool_set:N = \g_otex_load_layout_bool,   layout      .initial:n = true,
    fonts       .bool_set:N = \g_otex_load_fonts_bool,    fonts       .initial:n = true,
    ctex        .bool_set:N = \g_otex_load_ctex_bool,     ctex        .initial:n = true,
    theorems    .bool_set:N = \g_otex_load_theorems_bool, theorems    .initial:n = true,
    hyperref    .bool_set:N = \g_otex_load_hyperref_bool, hyperref    .initial:n = true,
    cleveref    .bool_set:N = \g_otex_load_cleveref_bool, cleveref    .initial:n = true,
    caption     .bool_set:N = \g_otex_load_caption_bool,  caption     .initial:n = true,
    algo        .bool_set:N = \g_otex_load_algo_bool,     algo        .initial:n = true,
    math        .bool_set:N = \g_otex_load_math_bool,     math        .initial:n = true,
    graphics    .bool_set:N = \g_otex_load_graphics_bool, graphics    .initial:n = true,
    listings    .bool_set:N = \g_otex_load_listings_bool, listings    .initial:n = true,
    minted      .bool_set:N = \g_otex_load_minted_bool,   minted      .initial:n = true,
    tables      .bool_set:N = \g_otex_load_tables_bool,   tables      .initial:n = true,
    floats      .bool_set:N = \g_otex_load_floats_bool,   floats      .initial:n = true,
    bib         .bool_set:N = \g_otex_load_bib_bool,      bib         .initial:n = true,
    toc         .bool_set:N = \g_otex_load_toc_bool,      toc         .initial:n = true,
    english     .bool_set:N = \g_otex_english_bool,       english     .initial:n = true,

    index       .bool_set:N = \g_otex_load_index_bool,    index       .initial:n = false,
    appendix    .bool_set:N = \g_otex_load_appendix_bool, appendix    .initial:n = false,
    floats-in-section .bool_set:N = \g_otex_float_section_bool, floats-in-section .initial:n = false,

    algorithms  .meta:n     = { algo = #1 },
    nolayout    .meta:n     = { layout = false },
    nofonts     .meta:n     = { fonts = false },
    noctex      .meta:n     = { ctex = false },
    notheorems  .meta:n     = { theorems = false },
    nohyperref  .meta:n     = { hyperref = false },
    nocleveref  .meta:n     = { cleveref = false },
    nocaption   .meta:n     = { caption = false },
    noalgo      .meta:n     = { algo = false },
    nomath      .meta:n     = { math = false },
    nographics  .meta:n     = { graphics = false },
    nolistings  .meta:n     = { listings = false },
    nominted    .meta:n     = { minted = false },
    notables    .meta:n     = { tables = false },
    nofloats    .meta:n     = { floats = false },
    nobib       .meta:n     = { bib = false },
    notoc       .meta:n     = { toc = false },

    bib-backend .tl_set:N   = \g_otex_bib_backend_tl,   bib-backend .initial:n = biblatex,
    bib-style   .tl_set:N   = \g_otex_bib_style_tl,     bib-style   .initial:n = ieee,
    algo-backend.tl_set:N   = \g_otex_algo_backend_tl,  algo-backend.initial:n = algorithm2e,
    font-set    .tl_set:N   = \g_otex_font_set_tl,      font-set    .initial:n = auto,

    main-font   .tl_set:N   = \g_otex_font_main_tl,
    sans-font   .tl_set:N   = \g_otex_font_sans_tl,
    mono-font   .tl_set:N   = \g_otex_font_mono_tl,
    cjk-main-font .tl_set:N = \g_otex_font_cjk_main_tl,

    pdf-title   .tl_set:N   = \g_otex_pdf_title_tl,   pdf-title   .initial:n = {Generated~Document},
    pdf-author  .tl_set:N   = \g_otex_pdf_author_tl,  pdf-author  .initial:n = {Orion},
  }

\ProcessKeysOptions { otex }

\RequirePackage { otex/otex-pkgcheck }
\RequirePackage { otex/otex-base }

\bool_if:NT \g_otex_load_math_bool     { \RequirePackage { otex/otex-math } }
\bool_if:NT \g_otex_load_theorems_bool { \RequirePackage { otex/otex-theorems } }
\bool_if:NT \g_otex_load_algo_bool     { \RequirePackage { otex/otex-algo } }
\bool_if:nTF { \g_otex_load_listings_bool || \g_otex_load_minted_bool } { \RequirePackage { otex/otex-code } } {}
\bool_if:NT \g_otex_load_graphics_bool { \RequirePackage { otex/otex-graphics } }
\bool_if:NT \g_otex_load_caption_bool  { \RequirePackage { otex/otex-caption } }
\bool_if:NT \g_otex_load_tables_bool   { \RequirePackage { otex/otex-tables } }
\bool_if:NT \g_otex_load_floats_bool   { \RequirePackage { otex/otex-floats } }

\bool_if:NT \g_otex_load_bib_bool      { \RequirePackage { otex/otex-bib } }
\bool_if:NT \g_otex_load_toc_bool      { \RequirePackage { otex/otex-toc } }
\bool_if:NT \g_otex_load_index_bool    { \RequirePackage { otex/otex-index } }
\bool_if:NT \g_otex_load_appendix_bool { \RequirePackage { otex/otex-appendix } }

\RequirePackage { otex/otex-chinese }
\RequirePackage { otex/otex-fonts }

\bool_if:NT \g_otex_load_layout_bool   { \RequirePackage { otex/otex-layout } }
\RequirePackage { otex/otex-refs }
\RequirePackage { otex/otex-commands }

\msg_new:nnn { otex } { best-effort } { otex~loaded~in~Best~Effort~mode. }
\msg_info:nn { otex } { best-effort }

\endinput