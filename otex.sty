\ProvidesPackage{otex}[Orion's Custom Package]

% ==========================================
%  1. 基础宏包与颜色配置
% ==========================================
\RequirePackage[table]{xcolor} % 颜色支持
% 预定义颜色方案
\definecolor{code_background}{rgb}{0.95, 0.95, 0.95} % 代码块背景: 浅灰
\definecolor{code_keyword}{rgb}{0.16, 0.32, 0.75}    % 关键字: 蓝色
\definecolor{code_comment}{rgb}{0.12, 0.38, 0.17}    % 注释: 深绿
\definecolor{code_string}{rgb}{0.63, 0.12, 0.94}     % 字符串: 紫色
\definecolor{code_identifier}{rgb}{0.0, 0.0, 0.0}    % 标识符: 黑色
\definecolor{code_number}{rgb}{0.5, 0.5, 0.5}        % 行号: 灰色

% ==========================================
%  2. 数学公式增强 (Math Enhancements)
% ==========================================
%  功能: 提供更强大的数学公式排版支持
\RequirePackage{amsmath}     % 基础数学宏包 (AMS)
\RequirePackage{amssymb}     % 数学符号库 (如 \mathbb)
\RequirePackage{mathtools}   % amsmath 的扩展修复和增强
\RequirePackage{amsthm}      % 定理环境支持

% 常用数学配置说明:
% \begin{align} ... \end{align} 用于多行对齐公式
% \begin{gather} ... \end{gather} 用于多行居中公式
% \mathbb{R} 实数集 R, \mathcal{L} 损失函数 L
% \DeclarePairedDelimiter 可用于定义自适应括号

% ==========================================
%  3. 定理环境配置 (Theorem Environments)
% ==========================================
%  功能: 自动编号的定理、引理、定义等环境
%  语法: \begin{theorem}[标题] ... \end{theorem}
\newtheoremstyle{mystyle}   % 定义样式名称
  {3pt}                     % 上间距
  {3pt}                     % 下间距
  {\normalfont}             % 正文字体
  {}                        % 缩进量
  {\bfseries}               % 定理头字体 (粗体)
  {:}                       % 标点
  {.5em}                    % 标点后间距
  {}                        % 头部说明 (默认)

\theoremstyle{mystyle}      % 使用定义好的样式

% 定义具体环境 (中文名称)
\newtheorem{theorem}{定理}[section]     % 定理,跟随 section 编号, 如 1.1
\newtheorem{lemma}[theorem]{引理}       % 引理,共享定理编号
\newtheorem{proposition}[theorem]{命题} % 命题
\newtheorem{corollary}[theorem]{推论}   % 推论
\newtheorem{definition}[theorem]{定义}  % 定义
\newtheorem{example}[theorem]{例}       % 例
\newtheorem{remark}[theorem]{注}        % 注
\newtheorem{assumption}[theorem]{假设}  % 假设

% ==========================================
%  4. 算法与伪代码 (Algorithms)
% ==========================================
%  功能: 排版算法伪代码
%  文档: http://mirrors.ctan.org/macros/latex/contrib/algorithm2e/doc/algorithm2e.pdf
\RequirePackage[ruled,linesnumbered,vlined]{algorithm2e}
% 配置:
% ruled: 标题在上方, 有双横线
% linesnumbered: 显示行号
% vlined: 代码块垂直连接线
%
% 用法示例:
% \begin{algorithm}[H]
%     \SetAlgoLined
%     \KwIn{输入}
%     \KwOut{输出}
%     \While{条件}{
%         操作\;
%     }
%     \caption{算法标题}
% \end{algorithm}

% ==========================================
%  5. 代码高亮 (Code Highlighting)
% ==========================================
\RequirePackage{listings}
\lstset{
    backgroundcolor=\color{code_background}, % 背景色
    basicstyle=\ttfamily\small,              % 字体: 等宽 + 小号
    keywordstyle=\color{code_keyword}\bfseries, % 关键字: 颜色 + 粗体
    commentstyle=\color{code_comment}\itshape,  % 注释: 颜色 + 斜体
    stringstyle=\color{code_string},         % 字符串
    identifierstyle=\color{code_identifier}, % 标识符
    numberstyle=\tiny\color{code_number},    % 行号样式
    numbers=left,                            % 行号位置: 左侧
    stepnumber=1,                            % 行号步长: 每一行都显示
    frame=single,                            % 边框: 单线框
    rulecolor=\color{gray!30},               % 边框颜色
    frameround=tttt,                         % 圆角边框
    breaklines=true,                         % 自动代码换行
    tabsize=4,                               % 制表符宽度
    showspaces=false,                        % 不显示空格符号
    showstringspaces=false,                  % 字符串中不显示空格
    extendedchars=true,                      % 扩展字符支持
    captionpos=b,                            % 标题位置: 底部
    escapeinside={(*@}{@*)},                 % 逃逸字符, 用于在代码中写LaTeX
}
% 支持中文代码的补丁 (xelatex下通常不需要特别处理，但为了保险)
\lstset{inputencoding=utf8}

% ==========================================
%  6. 图表与浮动体 (Figures & Tables)
% ==========================================
\RequirePackage{graphicx}    % 图片支持
\RequirePackage{caption}     % 标题样式控制
\RequirePackage{subcaption}  % 子图支持
\RequirePackage{booktabs}    % 三线表 (\toprule, \midrule, \bottomrule)
\RequirePackage{multirow}    % 表格行合并
\RequirePackage{array}       % 增强的列格式
\RequirePackage{float}       % 强力浮动体控制 (使用 [H] 禁止浮动)
\RequirePackage{longtable}   % 长表格
\RequirePackage{wrapfig}     % 图文环绕

% 标题设置
\captionsetup{
    font=small,              % 标题字体小一号
    labelfont=bf,            % 标签(如Figure 1)加粗
    labelsep=colon,          % 分隔符用冒号
    textfont=it              % 标题文本用斜体
}

% ==========================================
%  7. 列表与枚举 (Lists)
% ==========================================
\RequirePackage{enumitem}    % 列表定制
% 配置: \setlist[itemize]{...} 全局配置
% 用法: \begin{enumerate}[label=(\arabic*)] ... \end{enumerate}

% ==========================================
%  8. 单位与物理量 (SI Units)
% ==========================================
\RequirePackage{siunitx}
% 用法: \SI{10}{\meter\per\second} -> 10 m/s

% ==========================================
%  9. TikZ 绘图系统 (TikZ & PGF) - 核心新增
% ==========================================
\RequirePackage{tcolorbox}   % 彩色盒子

% 功能: 极其强大的绘图工具
\RequirePackage{tikz}
\usetikzlibrary{
    shapes,         % 形状库: ellipse, node styles
    arrows.meta,    % 箭头库: 提供更多箭头样式 (Stepper, Latex, etc.)
    positioning,    % 定位库: below = of node1
    calc,           % 计算库: ($ (a) + (b) $)
    patterns,       % 填充纹理: north east lines
    decorations.pathreplacing, % 路径装饰: brace (大括号)
    decorations.markings,      % 标记装饰: 在线上加箭头
    quotes,         % 引用语法: "label"
    fit,            % 自适应节点: fit=(a)(b)
    backgrounds,    % 背景层: on background layer
    shadows,        % 阴影: drop shadow
    trees,          % 树形图
    mindmap         % 思维导图
}

% --- PGFPlots 高级绘图库 ---
% 功能: 专业级函数绘图与数据可视化
\RequirePackage{pgfplots}
\pgfplotsset{compat=1.18}   % 使用最新兼容模式
\usepgfplotslibrary{
    fillbetween,            % 区域填充
    polar                   % 极坐标图
}

% --- TikZ 常用样式预定义 ---
% 1. 基础节点样式
\tikzset{
    base/.style = {draw, align=center, minimum height=2em, minimum width=2em},
    % 矩形框 (例如: 流程图处理块)
    process/.style = {base, rectangle, rounded corners, fill=orange!10},
    % 判断框 (例如: 流程图判断)
    decision/.style = {base, diamond, aspect=2, fill=blue!10, inner sep=0pt},
    % 输入输出 (平行四边形)
    io/.style = {base, trapezium, trapezium left angle=70, trapezium right angle=110, fill=green!10},
    % 开始/结束 (胶囊形)
    startstop/.style = {base, rounded rectangle, fill=red!10},
    % 箭头样式
    arrow/.style = {thick, ->, >=Stealth},
    % 连接线样式
    line/.style = {thick}
}

% ==========================================
%  10. 中文支持与排版优化 (Chinese Support)
% ==========================================
% CTeX 宏包配置
\RequirePackage[UTF8, heading=true, scheme=chinese]{ctex}
\RequirePackage{xeCJK}
\RequirePackage{fontspec}

% 字体设置 (建议根据系统安装字体调整)
% Win/Linux通用常用配置:
\setmainfont{Times New Roman}
\setsansfont{Arial}
% \setmonofont{Maple Mono NF}
% % 中文字体 - 优先匹配系统常见字体
% % 注意: 如果编译报错"Font not found", 请修改为系统实际存在的字体名
\setCJKmainfont{SimSun}      % 宋体
\setCJKsansfont{Source Han Sans CN}      % 黑体
% \setCJKmonofont{Source Han Sans CN}    % 黑体

% 微排版优化
\RequirePackage{microtype}
% 首行缩进 (即使是章节后的第一段)
\RequirePackage{indentfirst}

% ==========================================
%  11. 页面布局与页眉页脚 (Layout)
% ==========================================
% 仅在 article 类生效，避免冲突
\@ifclassloaded{article}{
    \RequirePackage{geometry}
    \geometry{
        a4paper,
        left=2.5cm,
        right=2.5cm,
        top=2.5cm,
        bottom=2.5cm
    }
    
    \RequirePackage{fancyhdr}
    \pagestyle{fancy}
    \fancyhf{}
    \lhead{\leftmark}       % 左页眉: 章节名
    \rhead{\thepage}        % 右页眉: 页码
}{}

% ==========================================
%  12. 引用与PDF元数据 (Hyperref)
% ==========================================
\RequirePackage{cite} % [1-3] 样式引用
\RequirePackage[pdfborder={0 0 0}]{hyperref} % 超链接
\hypersetup{
    colorlinks=true,        % 激活彩色链接
    linkcolor=blue,         % 内部链接(目录, 公式引用)颜色
    filecolor=magenta,      % 文件链接颜色
    urlcolor=cyan,          % URL链接颜色
    citecolor=green!50!black, % 引用颜色([1])
    pdftitle={Generated Document},
    pdfauthor={Orion},
}

% ==========================================
%  13. 自定义命令 (Custom Commands)
% ==========================================
% 语义化字体切换
\newcommand{\zh}[1]{{\CJKfamily{zhsong}#1}} % 强制宋体
\newcommand{\en}[1]{{\fontfamily{lmr}\selectfont#1}} % 强制英文字体

% 强调关键字: 红色加粗
\newcommand{\keyword}[1]{\textbf{\textcolor{red!80!black}{#1}}}

% 行内代码简化: 灰色背景+等宽
\newcommand{\code}[1]{\colorbox{gray!10}{\texttt{#1}}}

% 待办事项: 醒目黄底红字
\newcommand{\todo}[1]{\par\noindent\colorbox{yellow}{\textbf{TODO: } #1}\par}

\endinput