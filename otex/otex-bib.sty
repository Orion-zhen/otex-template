\ProvidesExplPackage {otex/otex-bib} {2026-01-16} {1.1} {Orion's Bibliography}

% Symbol detection for bibliography packages
% \printbibliography is representative of biblatex
% \citep is representative of natbib
\bool_new:N \l_otex_bib_configured_bool

\@ifpackageloaded{biblatex}{\bool_set_true:N \l_otex_bib_configured_bool}{}
\@ifpackageloaded{natbib}{\bool_set_true:N \l_otex_bib_configured_bool}{}
\cs_if_exist:NT \printbibliography {\bool_set_true:N \l_otex_bib_configured_bool}
\cs_if_exist:NT \citep {\bool_set_true:N \l_otex_bib_configured_bool}

\bool_if:NT \l_otex_bib_configured_bool
{
  \msg_warning:nnnn { otex } { pkg-skip } { biblatex/natbib } { bibliography~already~configured }
}

\bool_if:NF \l_otex_bib_configured_bool
{
  \str_case:VnF \g_otex_bib_backend_tl
  {
    {biblatex} { \otex_safe_require:nnnn { biblatex } { backend=bibtex, style=\g_otex_bib_style_tl, sorting=none, doi=true } {} {} }
    {natbib}   { \otex_safe_require:nnnn { natbib } { numbers, sort&compress } {} {} }
  }
  {
    \otex_safe_require:nnnn { biblatex } { backend=biber, style=ieee } {} {}
  }

  % Chinese localization for biblatex bibliography title
  % Only apply when otex loads biblatex (not when template pre-loads it)
  \cs_if_exist:NT \DefineBibliographyStrings
  {
    \bool_if:NF \g_otex_english_bool
    {
      \DefineBibliographyStrings{english}{
        bibliography = {参考文献},
        references = {参考文献},
      }
    }
  }

  % URL/DOI line breaking configuration for biblatex
  % Allow breaks at numbers (e.g., in DOIs like 10.3390/math14010158)
  \cs_if_exist:NT \setcounter
  {
    \setcounter{biburlnumpenalty}{100}
    \setcounter{biburlucpenalty}{100}
    \setcounter{biburllcpenalty}{100}
  }
}

\endinput
