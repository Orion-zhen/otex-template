\ProvidesExplPackage {otex/otex-chinese} {2026-01-16} {1.1} {Orion's Chinese Support}

\bool_if:NF \g_otex_load_ctex_bool { \endinput }

\bool_new:N \l_otex_safe_header_bool
% Dynamic check: If titlesec is loaded, it implies the class controls headings.
% In that case, we MUST NOT let ctex mess with them.
\@ifpackageloaded { titlesec }
{ \bool_set_false:N \l_otex_safe_header_bool }
{ \bool_set_true:N \l_otex_safe_header_bool }

\tl_new:N \l_otex_ctex_scheme_tl
\bool_if:NTF \g_otex_english_bool
{ \tl_set:Nn \l_otex_ctex_scheme_tl { plain } }
{ \tl_set:Nn \l_otex_ctex_scheme_tl { chinese } }

\bool_if:NTF \l_otex_safe_header_bool
{
  \otex_require:nnnn { ctex } { UTF8, scheme=\l_otex_ctex_scheme_tl, heading=true } {} {}
}
{
  % Conflict detected (titlesec loaded): Backoff to plain scheme, disable heading, AND disable fontset
  \msg_new:nnn { otex } { heading-backoff } { Package~'titlesec'~detected.~Disabling~ctex~heading~modification~and~fontset. }
  \msg_warning:nn { otex } { heading-backoff }
  \otex_require:nnnn { ctex } { UTF8, scheme=plain, heading=false, fontset=none } {} {}
}

\endinput
