\ProvidesExplPackage {otex/otex-chinese} {2026-01-18} {1.3} {Orion's Chinese Support}

\bool_if:NF \g_otex_load_ctex_bool { \endinput }

% pdfTeX 引擎检测：xeCJK 仅支持 XeTeX，但 ctex + CJK 可以在 pdfLaTeX 下工作
\sys_if_engine_pdftex:T
{
  \bool_if:NTF \g_otex_english_bool
  {
    % In English mode on pdfTeX, avoid loading ctex to prevent font conflicts (e.g. unisong20)
    % This is a "best effort" safe default.
    \msg_new:nnn { otex } { ctex-pdftex-skipped } { pdfTeX~detected~in~English~mode.~Skipping~ctex~loading. }
    \msg_info:nn { otex } { ctex-pdftex-skipped }
  }
  {
    \msg_new:nnn { otex } { ctex-pdftex } { pdfTeX~detected.~Loading~ctex~with~CJK~backend~(limited~CJK~support). }
    \msg_warning:nn { otex } { ctex-pdftex }
    \otex_require:nnnn { ctex } { UTF8, scheme=chinese, heading=false, fontset=none } {} {}
  }
  \endinput
}

% Determine ctex scheme based on language
\tl_new:N \l_otex_ctex_scheme_tl
\bool_if:NTF \g_otex_english_bool
{ \tl_set:Nn \l_otex_ctex_scheme_tl { plain } }
{ \tl_set:Nn \l_otex_ctex_scheme_tl { chinese } }

% Always load ctex with heading=false, delegate heading management to titlesec
% This provides more powerful customization capabilities
\otex_require:nnnn { ctex } { UTF8, scheme=\l_otex_ctex_scheme_tl, heading=false } {} {}

% Load titlesec submodule for heading management (controlled by g_otex_load_titlesec_bool)
\RequirePackage { otex/otex-titlesec }

\endinput
