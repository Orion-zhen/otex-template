\ProvidesExplPackage {otex/otex-layout} {2026-01-16} {1.1} {Orion's Layout}

\otex_safe_require:nnnn { geometry } { a4paper, left=2.5cm, right=2.5cm, top=2.5cm, bottom=2.5cm } { \geometry } {}

% 特殊类处理：standalone 类不需要页面布局
\@ifclassloaded{standalone}{\endinput}{}

% 状态敏感配置：实时追踪 fancyhdr 的加载谱系
\otex_safe_require:nnnn { fancyhdr } {} { \fancyhead }
{
  % 样式注入策略：仅当宏包由 otex 首次加载时启动，避免与模板原生定义的页眉页脚发生逻辑覆盖
  \bool_if:NF \l_otex_pkg_preloaded_bool
  {
    \pagestyle{fancy}
    \fancyhf{}

    \fancyhead[C]{\nouppercase{\leftmark}}
    \fancyfoot[C]{\thepage}

    % 标题页 (titlepage) 专有样式：隐去页码，且其内容不占用正文页码统计额度
    \fancypagestyle{titlepage}{
      \fancyhf{}
      \renewcommand{\headrulewidth}{0pt}
      \renewcommand{\footrulewidth}{0pt}
    }

    % 计数器逻辑修复：通过 Hook 强制在标题页结束后将其计数器重置为 0/1，确保正文正式起始
    \cs_if_exist:NTF \AfterEndEnvironment
    {
      \AfterEndEnvironment{titlepage}{\setcounter{page}{1}}
    }
    {
      \AtEndEnvironment{titlepage}{\setcounter{page}{0}}
    }

    % 环境增强：自动为自定义 titlepage 环境应用 empty 页面排版样式
    \AtBeginEnvironment{titlepage}{\thispagestyle{empty}}
  }
}

\endinput
