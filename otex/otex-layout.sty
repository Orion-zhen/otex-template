\ProvidesExplPackage {otex/otex-layout} {2026-01-16} {1.1} {Orion's Layout}

\otex_safe_require:nnnn { geometry } { a4paper, left=2.5cm, right=2.5cm, top=2.5cm, bottom=2.5cm } { \geometry } {}

% Track if fancyhdr was already loaded before otex
\bool_new:N \l__otex_layout_fancyhdr_preloaded_bool
\@ifpackageloaded { fancyhdr }
{ \bool_set_true:N \l__otex_layout_fancyhdr_preloaded_bool }
{ \bool_set_false:N \l__otex_layout_fancyhdr_preloaded_bool }

\otex_safe_require:nnnn { fancyhdr } {} { \fancyhead }
{
  % Only configure headers/titlepage if fancyhdr was NOT preloaded (i.e., otex loaded it)
  \bool_if:NF \l__otex_layout_fancyhdr_preloaded_bool
  {
    \pagestyle{fancy}
    \fancyhf{}

    \fancyhead[C]{\nouppercase{\leftmark}}
    \fancyfoot[C]{\thepage}

    % Configure titlepage: no page number, not counted in page numbering
    \fancypagestyle{titlepage}{
      \fancyhf{}
      \renewcommand{\headrulewidth}{0pt}
      \renewcommand{\footrulewidth}{0pt}
    }

    % Hook to reset page counter after titlepage environment ends
    \cs_if_exist:NTF \AfterEndEnvironment
    {
      \AfterEndEnvironment{titlepage}{\setcounter{page}{1}}
    }
    {
      \AtEndEnvironment{titlepage}{\setcounter{page}{0}}
    }

    % Apply empty style to titlepage by default
    \AtBeginEnvironment{titlepage}{\thispagestyle{empty}}
  }
}

\endinput
