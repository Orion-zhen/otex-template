\ProvidesExplPackage {otex/otex-math} {2025-01-16} {1.1} {Orion's Math Enhancements}

% ==============================================================================
% 数学宏包 loading
% ==============================================================================

\otex_smart_require:nnnn { amsmath } {} {} {}
\otex_smart_require:nnnn { mathtools } {} {} {}
\otex_smart_require:nnnn { amsthm } {} {} {}

% 引擎检测与 Unicode Math 支持
\sys_if_engine_pdftex:TF
  {
    \otex_smart_require:nnnn { amssymb } {} {} {}
  }
  {
    % XeLaTeX / LuaLaTeX 模式: Unicode Math
    % 注意: unicode-math 通常不应与 amssymb 同时加载
    \@ifpackageloaded { amssymb }
      {
         \msg_warning:nn { otex } { amssymb-conflict }
         % 仍然尝试加载 unicode-math，因为它可能修补? 或者用户可能知道自己在做什么
         \otex_smart_require:nnnn { unicode-math }
            { math-style=ISO, bold-style=ISO }
            { }
            {
               \AtBeginDocument{
                 \providecommand{\square}{\mdlgwhtsquare}
                 \providecommand{\boxtimes}{\boxtimes}
               }
            }
      }
      {
         \otex_smart_require:nnnn { unicode-math }
            { math-style=ISO, bold-style=ISO }
            { }
            {
               \AtBeginDocument{
                 \providecommand{\square}{\mdlgwhtsquare}
                 \providecommand{\boxtimes}{\boxtimes}
               }
            }
      }
  }

\msg_new:nnn { otex } { amssymb-conflict }
  { Package~'amssymb'~detected.~It~is~often~redundant~or~conflicting~with~'unicode-math'. }


\endinput
