\ProvidesExplPackage {otex/otex-math} {2026-01-16} {1.1} {Orion's Math Enhancements}

\otex_require:nnnn { amsmath } {} {} {}
\otex_require:nnnn { mathtools } {} {} {}
\otex_require:nnnn { amsthm } {} {} {}

\msg_new:nnn { otex } { amssymb-conflict } { Package~'amssymb'~conflict~with~'unicode-math'. }
\msg_new:nnn { otex } { math-pkg-backoff } { Legacy~math~package~'#1'~detected.~Disabling~unicode-math. }

% Logic: If pdfTeX or Font Package Detected -> Standard. Else -> Unicode Math.
\bool_new:N \l_otex_math_conflict_bool

% Dynamic detection of legacy math font packages
\clist_map_inline:nn { mathpazo, newtxmath, fourier, stix, stix2, mtpro2, eulervm }
{ 
  \@ifpackageloaded{#1}
  { 
    \bool_set_true:N \l_otex_math_conflict_bool 
    \msg_warning:nnn { otex } { math-pkg-backoff } { #1 }
  } 
  {} 
}
% Also check if class has set a flag (optional, but good practice) or simply rely on package loading.

\bool_lazy_or:nnTF { \sys_if_engine_pdftex_p: } { \l_otex_math_conflict_bool }
{
  \otex_require:nnnn { amsmath } {} {} {}
  % Load amssymb unless acmart (which has own symbols)
  \@ifclassloaded{acmart} {} { \otex_require:nnnn { amssymb } {} {} {} }
}
{
  % Unicode Math
  \@ifpackageloaded{amssymb} { \msg_warning:nn { otex } { amssymb-conflict } } {}

  \otex_require:nnnn { unicode-math } { math-style=ISO, bold-style=ISO } {} {}

  \AtBeginDocument{
    \otex_provide_command:Nnn \square { } { \mdlgwhtsquare }
    \otex_provide_command:Nnn \boxtimes { } { \boxtimes }
  }
}

\endinput
