\ProvidesExplPackage {otex/otex-theorems} {2026-01-16} {1.1} {Orion's Theorems}

\msg_new:nnn { otex } { amsthm-conflict } { Package~'ntheorem'~detected.~Skipping~'amsthm'. }

% Determine Theorem Name
\tl_new:N \l_otex_theorem_name_tl
\bool_if:NTF \g_otex_english_bool { \tl_set:Nn \l_otex_theorem_name_tl { Theorem } } { \tl_set:Nn \l_otex_theorem_name_tl { 定理 } }

% Legacy proof fix
\cs_if_exist:NF \@IEEElegacywarn { \providecommand{\@IEEElegacywarn}[2]{} }

% Helper definition for theorems
\cs_new:Nn \__otex_def_thm:nn 
  { \cs_if_exist:cF { #1 } { \newtheorem{#1}[theorem]{#2} } }

% Main logic
% Check if theorem counter already exists (defined by class, e.g. mdpi)
\cs_if_exist:cTF { c@theorem }
{
  % Class already defined theorems. We should back off.
}
{
  % Inner check: if \theorem cmd exists? (Usually \newtheorem defines it)
  % Actually, checking c@theorem is safer.
  % But we proceed if c@theorem does NOT exist.
  
  \cs_if_exist:cTF { theorem } 
  {
    % theorem command exists but c@theorem didn't? matching logic...
    % Assume conflicts if command exists.
  }
  {
    \@ifpackageloaded{ntheorem}
    { \msg_warning:nn { otex } { amsthm-conflict } }
    {
      \otex_require:nnnn { amsthm } {} {} {}

      % Style
      \cs_if_exist:cF { th@mystyle } 
      {
        \newtheoremstyle{mystyle}{3pt}{3pt}{\normalfont}{}{\bfseries}{:}{.5em}{}
        \theoremstyle{mystyle}
      }

      \newtheorem{theorem}{\l_otex_theorem_name_tl}[section]

      \bool_if:NTF \g_otex_english_bool
      {
        \__otex_def_thm:nn { lemma } { Lemma }
        \__otex_def_thm:nn { proposition } { Proposition }
        \__otex_def_thm:nn { corollary } { Corollary }
        \__otex_def_thm:nn { definition } { Definition }
        \__otex_def_thm:nn { example } { Example }
        \__otex_def_thm:nn { remark } { Remark }
        \__otex_def_thm:nn { assumption } { Assumption }
        \__otex_def_thm:nn { conjecture } { Conjecture }
        \__otex_def_thm:nn { axiom } { Axiom }
        \__otex_def_thm:nn { problem } { Problem }
        \__otex_def_thm:nn { exercise } { Exercise }
        \__otex_def_thm:nn { case } { Case }

        \cs_if_exist:cF { solution } { \newtheorem*{solution}{Solution} }
      }
      {
        \__otex_def_thm:nn { lemma } { 引理 }
        \__otex_def_thm:nn { proposition } { 命题 }
        \__otex_def_thm:nn { corollary } { 推论 }
        \__otex_def_thm:nn { definition } { 定义 }
        \__otex_def_thm:nn { example } { 例 }
        \__otex_def_thm:nn { remark } { 注 }
        \__otex_def_thm:nn { assumption } { 假设 }
        \__otex_def_thm:nn { conjecture } { 猜想 }
        \__otex_def_thm:nn { axiom } { 公理 }
        \__otex_def_thm:nn { problem } { 问题 }
        \__otex_def_thm:nn { exercise } { 练习 }
        \__otex_def_thm:nn { case } { 情形 }

        \cs_if_exist:cF { solution } { \newtheorem*{solution}{解答} }
      }
    }
  }
}

\endinput
