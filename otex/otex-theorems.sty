\ProvidesExplPackage {otex/otex-theorems} {2026-01-16} {1.1} {Orion's Theorems}

\msg_new:nnn { otex } { amsthm-conflict } { Package~'ntheorem'~detected.~Skipping~'amsthm'. }

% 国际化处理：根据全局语言设置动态确定“定理”名称
\tl_new:N \l_otex_theorem_name_tl
\bool_if:NTF \g_otex_english_bool { \tl_set:Nn \l_otex_theorem_name_tl { Theorem } } { \tl_set:Nn \l_otex_theorem_name_tl { 定理 } }

% 兼容性补丁：为旧版 IEEE 模板提供 proof 环境的占位符修复
\cs_if_exist:NF \@IEEElegacywarn { \providecommand{\@IEEElegacywarn}[2]{} }

% 自动化定义接口：批量创建基于 theorem 计数器的定理类环境
\cs_new:Nn \__otex_def_thm:nn
{ \cs_if_exist:cF { #1 } { \newtheorem{#1}[theorem]{#2} } }

% 逻辑入口：检测文档类是否已预设定理系统
% 计数器占用检测：若文档类 (如 mdpi) 已定义 theorem 计数器，则退避以避免定义冲突
\cs_if_exist:cTF { c@theorem }
{
  % 文类已定义同名计数器：otex 进入休眠状态以保护原生设置
}
{
  % 命令冲突检测：进一步判断 \theorem 命令的存在性
  % 策略：c@theorem 是判断定理包加载状态的最可靠指标
  % 判定：仅在计数器空闲时执行自动初始化

  % 智能加载 amsthm：
  % 1. 自动检测互斥包 (ntheorem)
  % 2. 自动检测守护符号 (\theorem) 防止覆盖现有定义
  \otex_safe_require:nnnn { amsthm } {} { \theorem }
  {
    % 样式定制 Hook：在 amsthm 成功加载后注入学术风格预设
    \cs_if_exist:cF { th@mystyle }
    {
      \newtheoremstyle{mystyle}{3pt}{3pt}{\normalfont}{}{\bfseries}{:}{.5em}{}
      \theoremstyle{mystyle}
    }

    \newtheorem{theorem}{\l_otex_theorem_name_tl}[section]

    \bool_if:NTF \g_otex_english_bool
    {
      \__otex_def_thm:nn { lemma } { Lemma }
      \__otex_def_thm:nn { proposition } { Proposition }
      \__otex_def_thm:nn { corollary } { Corollary }
      \__otex_def_thm:nn { definition } { Definition }
      \__otex_def_thm:nn { example } { Example }
      \__otex_def_thm:nn { remark } { Remark }
      \__otex_def_thm:nn { assumption } { Assumption }
      \__otex_def_thm:nn { conjecture } { Conjecture }
      \__otex_def_thm:nn { axiom } { Axiom }
      \__otex_def_thm:nn { problem } { Problem }
      \__otex_def_thm:nn { exercise } { Exercise }
      \__otex_def_thm:nn { case } { Case }

      \cs_if_exist:cF { solution } { \newtheorem*{solution}{Solution} }
    }
    {
      \__otex_def_thm:nn { lemma } { 引理 }
      \__otex_def_thm:nn { proposition } { 命题 }
      \__otex_def_thm:nn { corollary } { 推论 }
      \__otex_def_thm:nn { definition } { 定义 }
      \__otex_def_thm:nn { example } { 例 }
      \__otex_def_thm:nn { remark } { 注 }
      \__otex_def_thm:nn { assumption } { 假设 }
      \__otex_def_thm:nn { conjecture } { 猜想 }
      \__otex_def_thm:nn { axiom } { 公理 }
      \__otex_def_thm:nn { problem } { 问题 }
      \__otex_def_thm:nn { exercise } { 练习 }
      \__otex_def_thm:nn { case } { 情形 }

      \cs_if_exist:cF { solution } { \newtheorem*{solution}{解答} }
    }
  }
}

\endinput
