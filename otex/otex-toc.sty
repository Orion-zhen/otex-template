\ProvidesExplPackage {otex/otex-toc} {2026-01-18} {1.3} {Orion's TOC}

\bool_if:NF \g_otex_load_toc_bool { \endinput }

% 环境支撑探测：验证文档类是否定义了标准章节命令接口 (\l@section)，防止非标准类 (如 beamer) 编译报错
\cs_if_exist:NF \l@section
{
  \msg_warning:nnnn { otex } { pkg-skip } { tocloft } { \\l@section~undefined~(non-standard~document~class) }
  \endinput
}

% 目录控制增强 (tocloft)：通过特征命令及计数器 (\cftbeforetoctitleskip, \c@lofdepth) 探测加载状态
% 冲突预警：规避已定义 \c@lofdepth 的包 (如 subfig) 以防止底层计数器定义冲突
\bool_new:N \l_otex_toc_skip_bool
\cs_if_exist:NT \cftbeforetoctitleskip { \bool_set_true:N \l_otex_toc_skip_bool }
\cs_if_exist:NT \c@lofdepth { \bool_set_true:N \l_otex_toc_skip_bool }

\bool_if:NTF \l_otex_toc_skip_bool
{
  \msg_warning:nnnn { otex } { pkg-skip } { tocloft } { TOC~already~configured~or~lofdepth~conflict }
}
{
  % 注入逻辑：基于上方的多重探测结果执行安全加载，并初始化推荐的目录深度 (tocdepth)
  % 采用手动探测模式，故向安全加载器传递空的守护符号
  \otex_safe_require:nnnn { tocloft } {} {}
  {
    \setcounter{tocdepth}{3}
    \setcounter{secnumdepth}{3}
  }
}

\endinput
